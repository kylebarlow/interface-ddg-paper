\documentclass{article}
\usepackage[letterpaper, portrait, margin=1in]{geometry}
\usepackage[capitalise]{cleveref}
\usepackage{import}
\usepackage{booktabs}
\usepackage{multirow}
\usepackage{csvsimple}
\usepackage{longtable}
\usepackage{graphicx}
\usepackage{listings}
\usepackage{minted}
\usepackage{caption}

\newcommand\ddg{$\Delta\Delta G$}

\usepackage{xr} % Probably not needed for submission
\externaldocument{flex-ddG}

% A listing of the contents of each file supplied as Supporting Information
% should be included. For instructions on what should be included in the
% Supporting Information as well as how to prepare this material for
% publications, refer to the journal's Instructions for Authors.

% The following files are available free of charge.
% \begin{itemize}
% \item Filename: brief description
% \item Filename: brief description
% \end{itemize}

% Supplementary figures:
% \begin{itemize}
% \item \cref{tab:table-mult}
% \item \cref{fig:steps-v-corr}
% \item \cref{tab:table-versions}
% \item \cref{fig:structs-v-corr-id-zemu-12-60000-rscript-validated-t14}
% \item \cref{fig:structs-v-corr-WildTypeComplex-ddg-monomer-16-003-zemu-2}
% \item \cref{fig:wildtypecomplex-scores-complete}
% \item \cref{fig:spear-corr-rmsd-error}
% \item \cref{fig:t14-mean-ensemble}
% \item \cref{tab:table-ref}
% \item \cref{tab:table-antibodies}
% \item \cref{fig:t14-fits-feats}
% \end{itemize}

\begin{document}

\renewcommand{\thefigure}{S\arabic{figure}}
\setcounter{figure}{0}
\renewcommand{\thetable}{S\arabic{table}}
\setcounter{table}{0}
% \renewcommand{\lstlistingname}{Supporting Listing}

\subimport*{figs-and-tables/}{table-versions}
\subimport*{figs-and-tables/}{table-stabilizing}
\subimport*{figs-and-tables/}{table-temperature}

\clearpage
\input{table-by-structure}
\clearpage

\subimport*{figs-and-tables/}{structs-v-corr-id-zemu-12-60000-rscript-validated-t14}
\subimport*{figs-and-tables/}{structs-v-corr-WildTypeComplex-ddg-monomer-16-003-zemu-2}

\begin{figure}
  \centering
  \includegraphics[width=\textwidth,keepaspectratio]{figures/wildtypecomplex-scores-complete.pdf}
  \caption{
    Contour plot showing the effect of backrub sampling on the average wild-type complex score, for increasing numbers of averaged models. As the number of averaged structures N$_{struct}$ is increased along the x-axis, the average total score of the ensemble of modeled wild-type complexes (shown as colored contours in the body of the plot) also increases, as the wild-type complex models are first sorted according to their total scores and included in the averaged ensemble in order of increasing score.
    As the number of backrub sampling steps at which the ensemble is generated increases (along the y-axis), the total score of an ensemble of any number of structures tends to decrease, indicating that flex ddG is able to find lower-energy states (as measured in the Rosetta score function) as the simulation progresses. However, using only the lowest energy structures does not produce higher correlations with experimental \ddg\ values, as shown in \cref{fig:structs-v-corr-WildTypeComplex-zemu-12-60000-rscript-validated-t14}.
  } \label{fig:wildtypecomplex-scores-complete}
\end{figure}

\begin{figure}
  \centering
  \includegraphics[width=\textwidth,keepaspectratio]{figures/t14-mean-ensemble-error.pdf}
  \caption{
    The average pairwise ensemble RMSD for each complete output ensemble of 50 structures is shown versus increasing backrub sampling steps. For all analyzed subsets, including the complete dataset, pairwise ensemble RMSD increases with increasing backrub sampling steps, indicating that the diversity of sampled models (as measured by RMSD) continues to increase past the point around 30k-35k sampling steps where correlation with experimental \ddg\ values levels out. Subset legend: ala = mutation(s) to alanine; complete = complete ZEMu dataset; mult\_mut = multiple mutations (per data point); res\_gt15\_lt25 = resolution of the input wild-type structure $> 1.5\ \AA$ and $< 2.5\ \AA$; res\_gte25 = resolution of the input wild-type structure $>=\ 2.5\ \AA$; res\_lte15 = resolution of the input wild-type structure $<=\ 1.5\ \AA$; s2l = small-to-large mutation(s); sing\_mut = single mutations.
  } \label{fig:t14-mean-ensemble}
\end{figure}

\begin{figure}
  \centering
  \includegraphics[width=\textwidth,keepaspectratio]{figures/t14-spear-corr.pdf}
  \caption[\ddg\ prediction error vs. ensemble RMSD]{
    Scatter plot showing the average Spearman correlation of ddG prediction error v. mean pairwise backrub ensemble RMSD, v. backrub steps.
    As mean backrub ensemble RMSD increases (\cref{fig:t14-mean-ensemble}), we do not see any significant change in Spearman rank-order correlation between mean ensemble RMSD and ddG error (y-axis), as backrub steps increase (x-axis).
    This demonstrates that mean pairwise backrub ensemble RMSD might not be an effective metric to measure the degree to which we have sampled ``enough''.
  } \label{fig:spear-corr-rmsd-error}
\end{figure}

\begin{figure}
  \centering
  \includegraphics[width=\textwidth,keepaspectratio]{figures/zemu-sigmoid2-corrs.png}
  \caption[Interface \ddg prediction performance with sigmoid fit score function]{
    Left: standard flex ddG Rosetta output (non-fitted predictions) vs. experimental \ddg\ values. Right: Generalized additive model (GAM) flex ddG predictions vs. experimental data. Top: Control (no backrub) predictions. Middle: Flex ddG run with the Talaris energy function for 30,000 backrub steps with kT=1.2, averaged over 50 output scores. Bottom: Flex ddG run with the REF energy function, also for 30,000 backrub steps with kT=1.2, averaged over 50 output scores. The GAM is able to reduce the number of outlier flex ddG predictions, particularly relatively neutral values that Rosetta predicts to be highly destabilizing. This improvement in performance is most likely due to the ability of the sigmoid member functions of the GAM to limit extreme score term values once they are no longer predictive.
  } \label{fig:t14-fit-scatter}
\end{figure}

\begin{figure}
  \centering
  \includegraphics[width=\textwidth,keepaspectratio]{figures/zemu-sigmoid2-tal-feats.png}
  \caption[Sigmoid fit Rosetta score function terms]{
    Sigmoid functions resulting from application of unbiased logistic scaling to individual Rosetta score terms in a generalized additive model. Extreme values for most score terms are downweighted, except for long-range hydrogen bond interactions between backbone atoms (hbond\_lr\_bb).
  } \label{fig:t14-fits-feats}
\end{figure}

\subimport*{figs-and-tables/}{table-ref}

\clearpage

\csvreader[
longtable=|c|c|c|p{8cm}|r|,
table head=\caption{Curated ZEMu dataset with experimental \ddg\ values}\label{tab:zemu-filtered}\\\hline
ID & PDB & Res. & Mutations & \ddg\\\hline
\endhead\hline\endfoot,
% \csvlinetotablerow\\\hline
% \endfirsthead\hline
% \csvlinetotablerow\\\hline
% \endhead\hline
% \endfoot,
]
{figures/table-zemu-filtered.csv}
{1=\DataSetID,2=\PDBFileID,3=\Resolution,4=\Mutations,5=\ExperimentalDDG}
{\DataSetID & \PDBFileID & \Resolution & \Mutations & \ExperimentalDDG}

\captionof{listing}{
  Flex ddg Rosetta Script implementation
  \label{lst:ddg-script}
}
\inputminted[
linenos=true,
% frame=single,
breaklines
]
{xml}
{listings/ddG-backrub.xml}

\clearpage

\end{document}